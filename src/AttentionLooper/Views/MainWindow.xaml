<Window x:Class="AttentionLooper.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:AttentionLooper.Controls"
        xmlns:converters="clr-namespace:AttentionLooper.Converters"
        xmlns:vm="clr-namespace:AttentionLooper.ViewModels"
        Title="AttentionLooper"
        Width="380" Height="360"
        MinWidth="320" MinHeight="280"
        Background="{DynamicResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <converters:BoolToPlayStopIconConverter x:Key="PlayStopConverter" />

        <!-- Flat button style -->
        <Style x:Key="FlatButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Padding" Value="6,4" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ButtonHoverBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox item style -->
        <Style x:Key="ThemedComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,2" />
        </Style>

        <!-- TextBox style -->
        <Style x:Key="ThemedTextBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>
    </Window.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Row 0: Controls -->
        <Grid Grid.Row="0" Margin="0,0,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Play/Stop button -->
            <Button Grid.Column="0"
                    Style="{StaticResource FlatButton}"
                    Command="{Binding TogglePlayStopCommand}"
                    ToolTip="Play / Stop"
                    Width="32" Height="28">
                <Path Data="{Binding IsPlaying, Converter={StaticResource PlayStopConverter}}"
                      Fill="{DynamicResource AccentBrush}"
                      Stretch="Uniform"
                      Width="14" Height="14" />
            </Button>

            <!-- Sound dropdown -->
            <ComboBox Grid.Column="1"
                      Style="{StaticResource ThemedComboBox}"
                      ItemsSource="{Binding SoundNames}"
                      SelectedItem="{Binding SelectedSoundName}"
                      Margin="6,0"
                      DropDownOpened="SoundComboBox_DropDownOpened" />

            <!-- Period input -->
            <TextBox Grid.Column="2"
                     Style="{StaticResource ThemedTextBox}"
                     Text="{Binding PeriodText, UpdateSourceTrigger=PropertyChanged}"
                     Width="56"
                     TextAlignment="Center"
                     ToolTip="{Binding PeriodErrorMessage}"
                     Margin="0,0,6,0" />

            <!-- Theme toggle -->
            <ComboBox Grid.Column="3"
                      Style="{StaticResource ThemedComboBox}"
                      ItemsSource="{Binding ThemeOptions}"
                      SelectedItem="{Binding SelectedTheme}"
                      Width="68" />
        </Grid>

        <!-- Row 1: Waveform -->
        <Border Grid.Row="1"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="4"
                Margin="0,0,0,6">
            <controls:WaveformDisplay Peaks="{Binding WaveformPeaks}" />
        </Border>

        <!-- Row 2: Countdown -->
        <TextBlock Grid.Row="2"
                   Text="{Binding CountdownText}"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   FontSize="28"
                   FontWeight="Light"
                   FontFamily="Segoe UI"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,6" />

        <!-- Row 3: Collapsible Log -->
        <Expander Grid.Row="3"
                  IsExpanded="{Binding IsLogVisible}"
                  Foreground="{DynamicResource TextMutedBrush}"
                  BorderBrush="{DynamicResource BorderBrush}"
                  BorderThickness="0,1,0,0">
            <Expander.Header>
                <TextBlock Foreground="{DynamicResource TextMutedBrush}" FontSize="11">
                    <Run Text="Log (" /><Run Text="{Binding LogMessages.Count, Mode=OneWay}" /><Run Text=" entries)" />
                </TextBlock>
            </Expander.Header>
            <ScrollViewer MaxHeight="120"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding LogMessages}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       FontSize="11"
                                       FontFamily="Consolas"
                                       TextWrapping="Wrap"
                                       Margin="2,1" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Expander>
    </Grid>
</Window>
